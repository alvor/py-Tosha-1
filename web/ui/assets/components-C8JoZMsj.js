import{r as x,d as M,a as K,c,o as n,F as O,b as N,e as L,n as k,w as B,f as e,g as U,h as A,i as f,j as Q,k as P,T as V,u as $,v as W,t as p,K as oe,l as ie,m as I,p as Y,q,s as R,x as ee,y as F,z as te,A as ue,B as ce,C as le}from"./vendor-7G-r9wca.js";import{u as Z,a as ae}from"./router-sw4pOWQ9.js";const re="/assets2/py-tosha-a.svg",se="/assets2/py-Tosha.svg",ne="/assets2/ios_spin.svg",S=x("http://192.168.1.108/"),y=x({}),de={class:"nav d-md2-none"},ve=["src"],_e={key:1,class:"space"},pe=M({__name:"Nav_Bar",setup(C){const i=[{img:"/assets2/net_wifi.svg",to:"/network",label:"network"},{img:"/assets2/folder_files.svg",to:"/files",label:"files"},{img:"/assets2/info.svg",to:"/info",label:"info"},{img:"/assets2/switches.svg",to:"/standard",label:"standard"},{img:"/assets2/schedule.svg",to:"/cron_scheduler",label:"scheduler"},{img:"",to:"",label:""},{img:"/assets2/settings.svg",to:"/settings",label:"settings"}];return(r,u)=>{const v=K("router-link");return n(),c("nav",de,[(n(),c(O,null,N(i,a=>(n(),c(O,null,[a.label?(n(),L(v,{key:0,class:k(["btn my-2 _mx-auto",{hilith:r.$route.path==a.to}]),title:a.label,to:a.to},{default:B(()=>[e("img",{src:a.img},null,8,ve)]),_:2},1032,["title","class","to"])):(n(),c("div",_e))],64))),64))])}}}),z=(C,i)=>{const r=C.__vccOpts||C;for(const[u,v]of i)r[u]=v;return r},me=z(pe,[["__scopeId","data-v-ea31eb6c"]]),fe={class:"layout"},ge={key:"1",src:re,class:"ma-1",alt:"py-Tosha logo"},he={key:"2",src:se,class:"ma-1",alt:"py-Tosha logo"},be={key:"2",src:se,class:"ma-1",alt:"py-Tosha logo"},ye={key:"2",src:ne,class:"ma-1",alt:"py-Tosha logo"},$e={style:{position:"relative"}},ke={style:{"_padding-left":"50px"}},we=M({__name:"LayoutDefault",setup(C){let i=x(!0);const r=Z();let u=x(!1);setTimeout(()=>u.value=!0,2222);const v=U(()=>{var s;return((s=y.value)==null?void 0:s.datetime)&&new Date(y.value.datetime).toISOString().slice(8,16).replace("T"," ")});let a=null;return A(()=>r.name,()=>{clearTimeout(a),a=setTimeout(()=>i.value=!1,7e3),!i.value&&setTimeout(()=>i.value=!0,400)}),(s,o)=>{const m=K("router-link"),_=K("router-view");return n(),c("div",fe,[e("header",null,[f(m,{to:"/",_target:"_blank",class:k(["logo",{home:s.$route.name!="home"}])},{default:B(()=>[f(V,{name:"fade"},{default:B(()=>[$(i)?(n(),c("img",ge)):(n(),c("img",he))]),_:1}),$(u)?Q((n(),c("img",be,null,512)),[[W,!1]]):P("",!0)]),_:1},8,["class"]),$(u)?Q((n(),c("img",ye,null,512)),[[W,!1]]):P("",!0),e("div",$e,[f(V,{name:"blurslide",appear:""},{default:B(()=>[(n(),c("h3",{class:"title text-h2",key:s.$route.meta.label||"py-Tosha"},p(s.$route.meta.label||"py-Tosha"),1))]),_:1})])]),e("main",ke,[f(me),f(_,{class:"view"},{default:B(({Component:t})=>[f(V,{name:"pagefade","_before-enter":"over_hide=true",_enter:"onEnter","_after-enter":"over_hide=false","_enter-cancelled":"over_hide=false"},{default:B(()=>[(n(),L(oe,{max:"3",key:$(S)},[(n(),L(ie(t),{class:"viewG"}))],1024))]),_:2},1024)]),_:1})]),e("footer",null,[e("ul",null,[e("li",{class:k({"bg-warn":$(y).err})},p(v.value),3),e("li",{class:k({"bg-warn":$(y).err})},[o[0]||(o[0]=I("m")),o[1]||(o[1]=e("span",{class:"d-sm-none"},"em",-1)),I(": "+p(~~($(y).mem_free/100)/10)+"k",1)],2),e("li",{class:k({"bg-warn":$(y).err})},[o[2]||(o[2]=e("span",{class:"d-sm-none"},"cpu: ",-1)),I(p(~~($(y).load*100+1))+"%",1)],2),e("li",{class:k({"bg-warn":$(y).err||$(y).cou_req==5,"bg-err":$(y).cou_req>5})},[o[3]||(o[3]=I("r")),o[4]||(o[4]=e("span",{class:"d-sm-none"},"eq",-1)),I(": "+p($(y).cou_req),1)],2)])])])}}}),el=z(we,[["__scopeId","data-v-83ed1935"]]),xe={key:0,src:ne},Ce={key:1,class:"mx-2",style:{"flex-grow":"1"}},Se=M({__name:"ZButton",props:{to:{type:[Object,String],required:!1},label:{},ladge:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},setup(C){return(i,r)=>{const u=K("router-link");return C.to?(n(),L(u,{key:0,class:k(["btn my-2 gggg _mx-auto",{ladge:C.ladge}]),to:C.to},{default:B(()=>[I(p(C.label),1)]),_:1},8,["class","to"])):(n(),c("a",{key:1,class:k(["btn my-2 _mx-auto",{ladge:C.ladge}]),_to:"to"},[Y(i.$slots,"prepend",{},void 0),C.loading?(n(),c("img",xe)):(n(),c("span",Ce,p(C.label),1))],2))}}}),h=z(Se,[["__scopeId","data-v-8aab3b82"]]),Te={class:"wrapper"},je={class:"d-flex_"},Oe=M({__name:"home",setup(C){return(i,r)=>(n(),c("div",Te,[e("div",je,[e("div",null,[f(h,{ladge:"",to:"/network",label:"network"})]),e("div",null,[f(h,{ladge:"",to:"/files",label:"files"})]),e("div",null,[f(h,{ladge:"",to:"/info",label:"info"})]),e("div",null,[f(h,{ladge:"",to:"/standard",label:"standard"})]),e("div",null,[f(h,{ladge:"",to:"/cron_scheduler",label:"scheduler"})]),e("div",null,[f(h,{ladge:"",to:"/servers_api",label:"servers-api list"})]),e("div",null,[f(h,{ladge:"",to:"/settings",label:"settings"})])])]))}}),Ie=z(Oe,[["__scopeId","data-v-ee03edbe"]]),tl=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"})),Pe={class:"row pa-2"},Me={class:"row pa-2"},Ne={class:"col-md-12 _col-4 px-2 text-b"},Be={class:"col-md-12 col-8 px-2"},Le={key:0,style:{"justify-items":"left"}},ze={class:"txt-left"},De={key:1},qe={class:"txt-left"},Ee={class:"txt-primary"},Ue=M({__name:"info",setup(C){const i=x(null);let r=null;function u(){fetch(`${S.value}api/status`).then(async s=>{if(s.ok){const o=await s.json();i.value=o}else i.value=[]}).catch(s=>i.value=[])}const v=U(()=>{var s;return((s=y.value)==null?void 0:s.datetime)&&new Date(y.value.datetime).toISOString().slice(8,16).replace("T"," ")});function a(){u()}return q(()=>{r=!0,u()}),R(()=>{r=!1}),A(()=>y.value.err,s=>{!s&&r&&u()}),(s,o)=>(n(),c("div",null,[o[1]||(o[1]=e("h3",null,"Информация",-1)),f(h,{onClick:o[0]||(o[0]=m=>s.$router.go(-1)),label:"<<",class:"mx-2"}),f(h,{onClick:a,label:"refresh"}),e("div",Pe,[e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])}," PLC time: "+p(v.value),3),e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])},"Free mem: "+p(~~($(y).mem_free/100)/10)+"k",3),e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])},"UpTime: "+p(~~($(y).uptime/60))+"min",3),e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])},"CPU load: "+p(~~($(y).load*100+1))+"%",3)]),(n(!0),c(O,null,N(i.value,(m,_)=>(n(),c("div",Me,[e("div",Ne,p(m.name),1),e("div",Be,[Array.isArray(m.state)?(n(),c("div",Le,[(n(!0),c(O,null,N(m.state,t=>(n(),c("div",ze,p(t),1))),256))])):(n(),c("div",De,[(n(!0),c(O,null,N(m.state,(t,l)=>(n(),c("div",qe,[e("b",Ee,p(l),1),I("="+p(t),1)]))),256))]))])]))),256))]))}}),ll=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),Je={class:"row px-2"},Ae={class:"list_files col-8 col-sm-12"},Re={class:"col-12 ma-2"},Fe={class:"ant mx-2"},Ke=["onClick"],Ze=M({__name:"network",setup(C){const i=x([]),r=x(""),u=x(!1);let v=0,a;function s(){u.value||(u.value=!0,fetch(`${S.value}api/net/scan`).then(async t=>{if(t.ok){const l=await t.json();r.value=l.connected,i.value=i.value.filter(d=>!l.available.find(w=>d[1]==w[1])&&d[6]+6>~~(Date.now()/1e3/60)),i.value.push(...l.available.map(d=>(d[0]=d[0]||d[1],d[6]=~~(Date.now()/1e3/60),d))),i.value=i.value.sort((d,w)=>d[3]>w[3]?-1:d[3]<w[3]?1:0)}}).finally(()=>{u.value=!1,!(v>3)&&(v++,a=setTimeout(s,(.5+v/3)*60*1e3))}))}function o(){if(!u.value&&confirm("Подтвердите действие - забыть сеть")){u.value=!0;const t={method:"delete"};fetch(`${S.value}api/net/config`,t).then(async l=>{l.ok&&(r.value="")}).finally(()=>{u.value=!1})}}function m(t){if(u.value)return;const l=prompt(`Введите ключ подключения к сетти ${t}`,"");if(l){u.value=!0;const d={method:"post",body:JSON.stringify({ssid:t,pswd:l})};fetch(`${S.value}api/net/config`,d).then(async w=>{w.ok}).finally(()=>{u.value=!1,s()})}}q(()=>{s()}),R(()=>{clearTimeout(a)});function _(t){return(t+99)*1.8}return(t,l)=>(n(),c("div",null,[f(h,{onClick:l[0]||(l[0]=d=>t.$router.go(-1)),label:"<<"}),l[3]||(l[3]=e("h2",{class:"ma-2"}," Network connection",-1)),e("div",Je,[l[2]||(l[2]=e("div",{class:"list_files_ col-4 col-sm-12 justify-cc",style:{"padding-top":"8px"}}," Список доступных сетей: ",-1)),e("div",Ae,[f(h,{onClick:l[1]||(l[1]=d=>{ee(v)?v.value=1:v=1,s()}),label:"scan",loading:u.value,style:{width:"90px"}},null,8,["loading"]),(n(!0),c(O,null,N(i.value,d=>(n(),c("div",Re,[e("div",null,p(r.value==d[0]?"*":"")+" "+p(d[0]),1),e("div",Fe,[e("div",{class:"progress",style:F(`height:${_(d[3])}% ; width:${_(d[3])}% `)},null,4)]),e("div",null,[r.value==d[0]?(n(),c("a",{key:0,class:"cursor-p",onClick:o}," забыть ")):(n(),c("a",{key:1,class:"cursor-p",onClick:w=>m(d[0])}," подключить ",8,Ke))])]))),256))])])]))}}),Ve=z(Ze,[["__scopeId","data-v-3cf940e9"]]),al=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"})),Ge={class:"row px-2",style:{"min-height":"5px"}},He={class:"list_files row"},Xe={class:"col-4 col-md-6 col-sm-12 align-ic px-2"},Qe=["onClick"],We={class:"row pa-2",style:{"white-space":"break-spaces"}},Ye={class:"col-3 col-md-4 col-sm-6"},et={class:"text-b"},tt={class:"col-3 col-md-4 col-sm-6"},lt={class:"text-b"},at={class:"col-3 col-md-4 col-sm-6"},st={class:"text-b"},nt=M({__name:"files",setup(C){const i=x([]),r=x({used:null,free:null,total:null}),u=x(null),v=ae(),a=x(!1);function s(_=""){a.value=!0,fetch(`${S.value}api/ls/${_}`).then(async t=>{if(t.ok){const l=await t.json();if(!l)return;i.value=l.files,r.value.free=l.free,r.value.total=l.total,r.value.used=l.used,u.value=l.currdir}}).finally(()=>a.value=!1)}function o(_=""){confirm("Готовы удалить этот файл или папку?")&&fetch(`${S.value}api/delete/${_}`,{method:"delete"}).then(async t=>{t.ok?s():alert("Ошибка, что-то пошло не так...")}).catch(t=>alert("Ошибка, что-то пошло не так..."))}function m(_,t){t===16384&&s(`?chdir=${_}`),t===32768&&v.push({name:"show_content",query:{file_name:_}})}return q(()=>{setTimeout(()=>{s()},9)}),(_,t)=>(n(),c("div",null,[i.value.find(l=>l[0]=="/")?(n(),L(h,{key:0,onClick:t[0]||(t[0]=l=>m("/",16384)),label:"/",class:"mx-2"})):P("",!0),i.value.find(l=>l[0]=="..")?(n(),L(h,{key:1,onClick:t[1]||(t[1]=l=>m("..",16384)),label:"<<",class:"mx-2"})):P("",!0),f(h,{onClick:t[2]||(t[2]=l=>s()),label:"refresh",class:"mx-2"}),f(h,{_click:"set_params(r)",label:"upload",class:"mx-2"}),e("h3",null,"Current dir: "+p(u.value),1),e("div",Ge,[e("div",{v_if:"loading",class:k(["loader",{loading:a.value}])},null,2)]),e("div",He,[(n(!0),c(O,null,N(i.value,l=>(n(),c("div",Xe,[e("span",{class:k(["file_nm",{folder:l[1]==16384}]),onClick:d=>m(l[0],l[1])},p(l[0]),11,Qe),e("span",null,[f(h,{_click:"scan",onClick:d=>o(l[0]),label:"x"},null,8,["onClick"])])]))),256))]),e("div",We,[e("div",Ye,[t[3]||(t[3]=I(" total: ")),e("span",et,p(~~(r.value.total/100)/10)+" K",1)]),e("div",tt,[t[4]||(t[4]=I(" free: ")),e("span",lt,p(~~(r.value.free/100)/10)+" K",1)]),e("div",at,[t[5]||(t[5]=I(" used: ")),e("span",st,p(~~(r.value.used/100)/10)+" K",1)])])]))}}),ot=z(nt,[["__scopeId","data-v-97243bc8"]]),sl=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"})),it={style:{position:"sticky",top:"0",left:"0","max-width":"inherit"}},ut={class:"row px-2",style:{"min-height":"5px"}},ct={class:"list_files row px-2",style:{"_max-width":"inherit"}},rt=["contenteditable","textContent"],dt=M({__name:"show_content",setup(C){const i=x(null),r=Z();let u=null;const v=x(!1);let a=x(!1);const s=x([]);function o(){v.value=!0,fetch(`${S.value}show_content/?file_name=${u}`).then(async t=>{if(t.ok){a.value=!1;const l=await t.text();i.value=l,s.value=l.split(`
`),m.value=!1}}).finally(t=>v.value=!1)}q(()=>{if(u===r.query.file_name)return;i.value=null,u=r.query.file_name,setTimeout(()=>{o()},9);const t=document.querySelector("#f_content");t.oninput=()=>m.value=!0});const m=x(!1);function _(t){const l=new FormData,d=document.querySelector("#f_content");let T=new URLSearchParams(document.location.search).get("file_name");const D=d.textContent;let g=new Blob([D],{type:"text/plain"});l.append("files",g);const b=new XMLHttpRequest;b.open("PUT",`${S.value}api/upload/${T}`,!0),b.addEventListener("load",()=>{v.value=!1,m.value=!1}),b.onreadystatechange=function(){b.readyState==4&&o()},b.addEventListener("error",()=>{v.value=!1,alert("Upload Error!")}),v.value=!0,b.send(D)}return(t,l)=>(n(),c("div",null,[e("div",it,[f(h,{onClick:l[0]||(l[0]=d=>t.$router.go(-1)),label:"<<",class:"mx-2"}),f(h,{onClick:l[1]||(l[1]=d=>o()),label:"refresh",class:"mx-2"}),f(h,{onClick:l[2]||(l[2]=d=>ee(a)?a.value=!$(a):a=!$(a)),label:"edit",class:"mx-2"}),$(a)||m.value?(n(),L(h,{key:0,class:"mx-2 bg-warn",onClick:_,label:"save"})):P("",!0)]),e("h3",null,p(t.$route.query.file_name),1),e("div",ut,[e("div",{v_show:"loading",class:k(["loader",{loading:v.value}])},null,2)]),e("div",ct,[e("pre",{v_if:"!edit_mode",contenteditable:$(a),id:"f_content",style:{"white-space":"pre-wrap","background-color":"#eeeeee",padding:"2px"},textContent:p(i.value),_input:"file_content = $event.target.innerText ",onBlur:l[3]||(l[3]=d=>i.value=d.target.innerText)},null,40,rt),P("",!0)])]))}}),vt=z(dt,[["__scopeId","data-v-fd44aa78"]]),nl=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"})),_t={class:"row px-2"},pt={class:"col-6 col-md-12 px-2 _text-b align-ic"},mt={class:"mx-2"},ft=M({__name:"switches",setup(C){const i=x(null);let r,u=0;function v(){r&&r.close(),r=new EventSource(`${S.value}api/switches/ls/?check_id=${u}`,{__withCredentials:!0,__heartbeatTimeout:12e4}),r.onmessage=s=>{try{const o=JSON.parse(s.data);u=s.lastEventId,i.value=o}catch(o){console.warn("evtSource_message_22: ",s.data.slice(0,4),s.data,o)}}}function a(s){const o={method:"put",body:JSON.stringify([{id:s.id,value:s.value}])};fetch(`${S.value}api/switches/set`,o).then(async m=>{m.ok})}return q(()=>{v()}),R(()=>{r&&r.close()}),(s,o)=>{var m,_;return n(),c("div",null,[f(h,{onClick:o[0]||(o[0]=t=>s.$router.go(-1)),label:"<<",class:"mx-2"}),o[1]||(o[1]=e("h3",null,"Switch view block ",-1)),e("div",_t,[(n(!0),c(O,null,N((m=i.value)==null?void 0:m.data,t=>(n(),c("div",pt,[f(h,{onClick:l=>{t.value=!t.value,a(t)},ladge:"",label:(t==null?void 0:t.name)||"switch"},{prepend:B(()=>[e("div",{class:k(["lamp",{on:t.value===1,off:t.value===0}]),_label:"switch"},null,2)]),_:2},1032,["onClick","label"]),e("div",{class:k(["lamp",{on:t.value===1,off:t.value===0}]),_label:"switch"},null,2),e("span",mt,p(t.id)+" = "+p(t.value),1)]))),256))]),I(" tt: "+p((_=i.value)==null?void 0:_.time),1)])}}}),ol=Object.freeze(Object.defineProperty({__proto__:null,default:ft},Symbol.toStringTag,{value:"Module"})),gt={class:"mx-2 label"},ht=M({__name:"ZIndicator",props:{value:{},group:{}},emits:["change"],setup(C,{emit:i}){const r=i,u=x(!1),v=C,a=U(()=>v.value),s=U(()=>v.value.direction||"right"),o=U(()=>{const _=a.value.max-a.value.min;return Math.min(99,Math.max(1,Math.round((a.value.value-a.value.min)*100/_)))});A(()=>a.value.value,()=>{u.value=!0,setTimeout(()=>u.value=!1,3222)});function m(_){const t=prompt("Input value ",_.value);t!==null&&Number(t)&&t.length>0?(_.value=Number(t),r("change",{r:_,value:Number(t),group:v.group})):t!==null&&(_.value=t,r("change",{r:_,value:t,group:v.group}))}return(_,t)=>(n(),c("div",{class:k(["indicator my-2 pa-1",{digital:a.value.indicator=="digital"}])},[Y(_.$slots,"prepend",{},void 0),e("span",gt,p(a.value.name),1),a.value.indicator=="digital"&&!["digital"].includes(a.value.control)?(n(),c("div",{key:0,class:"mx-2 digital2",style:F([`background-color: ${a.value.value?"#00cc66":"#114422"} ;`])},null,4)):a.value.indicator=="analog"&&(a.value.min||a.value.max)&&["right","left"].includes(s.value)?(n(),c("div",{key:1,class:k(["mx-2 analog horisontal",[a.value.class,"dir-"+(a.value.direction||"right")]])},[e("div",{style:F([`width: ${o.value}%;`])},null,4)],2)):a.value.indicator=="analog"&&(a.value.min||a.value.max)?(n(),c("div",{key:2,class:k(["analog vertical",[a.value.class,"dir-"+a.value.direction||"right"]]),_style:"[]"},[e("div",{style:F([`height: ${o.value}%;`])},null,4)],2)):(n(),c("div",{key:3,class:k(["mx-2 any",[a.value.class]]),_style:"[`background-color: ${!value ? '#00cc66':'#114422'} ;`]"},null,2)),a.value.indicator=="analog"?(n(),c("span",{key:4,class:k(["px-2 value _control text-b",{modified:u.value,control:a.value.control}]),onClick:t[0]||(t[0]=te(l=>m(a.value),["stop"]))},p(a.value.value)+" "+p(a.value.measure),3)):a.value.indicator=="digital"&&a.value.text!==void 0?(n(),c("span",{key:5,class:k(["px-2 value text",{modified:u.value}])},p(a.value.text)+" "+p(a.value.measure),3)):P("",!0)],2))}}),bt=z(ht,[["__scopeId","data-v-8ffd1217"]]),yt={class:"row px-2"},$t={class:"col-12 _pa-md-2 justify-cc"},kt={class:"row px-2",v_for:"group in controls"},wt={class:"col-4 col-md-6 col-sm-12 px-2 pa-md-2 _text-b align-ic justify-cc"},xt=M({__name:"standard_det",setup(C){const i=x([]);let r,u=0;const v=Z(),a=x(null),s=x(null),o=x(null);function m(){r&&r.close();const l=s.value||a.value;r=new EventSource(`${S.value}api/standard/grp/${l}`,{__withCredentials:!0,__heartbeatTimeout:12e4}),r.onmessage=d=>{try{const w=JSON.parse(d.data);u=d.lastEventId,a.value=w.name,o.value=w.label;const T=w.name,D=i.value.findIndex(g=>g.name==T);D>=0?i.value[D]=w:i.value.push(w)}catch(w){console.warn("evtSource_message_22: ",d.data.slice(0,4),d.data,w)}}}function _(l,d,w){const T={method:"put",body:JSON.stringify([{id:l.id,value:d}])};fetch(`${S.value}api/standard/set/${w.name}`,T).then(async D=>{D.ok})}A(()=>{var l;return(l=v.query)==null?void 0:l.nm_module},l=>{l&&l!==a.value&&(r&&r.close(),m())}),ue(()=>{var l,d,w;a.value=(l=v.query)==null?void 0:l.nm_module,s.value=(d=v.params)==null?void 0:d.nm_group,o.value=(w=v.query)==null?void 0:w.label,i.value.push({name:a.value}),m()}),ce(()=>{r&&r.close()});function t(l){console.log("onchange_value: ",l),_(l.r,l.value,l.group)}return(l,d)=>(n(),c("div",null,[f(h,{onClick:d[0]||(d[0]=w=>l.$router.go(-1)),label:"<<",class:"mx-2"}),P("",!0),(n(!0),c(O,null,N(i.value,w=>(n(),c(O,null,[e("div",yt,[e("h5",$t,p(w.label),1)]),e("div",kt,[(n(!0),c(O,null,N(w.data,(T,D)=>(n(),c("div",wt,[T.indicator!="digital"||!["digital"].includes(T.control)?(n(),L(bt,{key:0,value:T,_click:"set_page(r)",group:w,onChange:t,style:{"flex-grow":"2"}},{default:B(()=>[I(p(T.name),1)]),_:2},1032,["value","group"])):P("",!0),["digital"].includes(T.control)?(n(),L(h,{key:1,_class:"ma-md-2",onClick:g=>_(T,!T.value,w),style:{"flex-grow":"1"},ladge:"",label:T.name},le({default:B(()=>[d[1]||(d[1]=I(" * "))]),_:2},[T.indicator=="digital"?{name:"prepend",fn:B(()=>[e("div",{class:k(["lamp",{on:T.value===1,off:T.value===0}]),_label:"switch"},null,2)]),key:"0"}:void 0]),1032,["onClick","label"])):P("",!0)]))),256))])],64))),256))]))}}),Ct=z(xt,[["__scopeId","data-v-760d9f20"]]),St={key:1},Tt={class:"row px-2"},jt={class:"col-6 col-md-12 px-2 _text-b align-ic justify-cc"},Ot=["onClick","label"],It=M({__name:"standard",setup(C){const i=x(null),r=ae();function u(){fetch(`${S.value}api/standard/ls`).then(async s=>{if(s.ok){const o=await s.json();i.value=o.modules}})}function v([s,o]){r.push({name:"standard",query:{nm_module:s,label:o}})}function a([s,o,m]){r.push({name:"standard_grp",params:{nm_group:m},query:{nm_module:s,label:o}})}return q(()=>{u()}),R(()=>{}),(s,o)=>{var m,_,t,l;return n(),c("div",null,[(m=s.$route.query)!=null&&m.nm_module||(_=s.$route.params)!=null&&_.nm_group?(n(),L(Ct,{key:0})):P("",!0),!((t=s.$route.query)!=null&&t.nm_module)&&!((l=s.$route.params)!=null&&l.nm_group)?(n(),c("div",St,[o[0]||(o[0]=e("h3",null," Standard modules ",-1)),e("div",Tt,[(n(!0),c(O,null,N(i.value,d=>(n(),c("div",jt,[f(h,{onClick:w=>v(d),ladge:"",label:d[1]},le({_:2},[d[2]?{name:"prepend",fn:B(()=>[d[2]?(n(),c("div",{key:0,class:"btn_group",onClick:te(w=>a(d),["prevent","stop"]),_ladge:"",label:d[2]},p(d[2]),9,Ot)):P("",!0)]),key:"0"}:void 0]),1032,["onClick","label"]),(d[2],P("",!0))]))),256))])])):P("",!0)])}}}),Pt=z(It,[["__scopeId","data-v-d43a2c59"]]),il=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"})),Mt={class:"row pa-2"},Nt={class:"row pa-md-2"},Bt={class:"col-md-12 _col-4 px-2 text-b"},Lt={class:"col-md-12 _col-8 _px-2"},zt={class:"row pa-md-2"},Dt={class:"col-md-12 _col-6 _pa-md-2",style:{"flex-grow":"1"}},qt={class:"col-12 pa-2",v__for:"(r,i) in cron_list?.tasks",__style:"width: 650px;",style:{overflow:"auto","_max-width":"calc(100vw - 30px)"}},Et={class:"px-2"},Ut={class:"col-md-12 _col-6 px-2",style:{"flex-grow":"1"}},Jt={class:"col-12 pa-2 align-ic"},At={class:"px-2"},Rt={class:"col-12 _px-2 align-ic"},Ft=M({__name:"cron_scheduler",setup(C){const i=x(null);let r=null;const u=x(!1),v=x(null),a=x(void 0);function s(){u!=!0&&fetch(`${S.value}api/cron/ls`).then(async g=>{if(g.ok){const b=await g.json();i.value=b,u.value=!1}else sys_info.value=[]}).catch(g=>sys_info.value=[])}function o(){u!=!0&&fetch(`${S.value}api/cron/ls/reload`).then(async g=>{if(g.ok){const b=await g.json();i.value=b,u.value=!1}else sys_info.value=[]}).catch(g=>sys_info.value=[])}const m=U(()=>{var g;return((g=y.value)==null?void 0:g.datetime)&&new Date(y.value.datetime).toISOString().slice(8,16).replace("T"," ")});function _(g){i.value.tasks.push([!0,"- * * * *",g[0],g[2],g[1]])}function t(g){const b=prompt("Input schedule format [* * * * *] ",g[1]);b.trim().split(/\s+/).length==5&&(g[1]=b,u.value=!0)}function l(g){const b=prompt("Input params ",JSON.stringify(g[3]));if(b!==null){try{g[3]=JSON.parse(b)}catch{g[3]="params"}u.value=!0}}function d(g){const b=prompt("Input label ",g[4]);b!==null&&(g[4]=b,u.value=!0)}function w(){s()}q(()=>{r=!0,s()}),R(()=>{r=!1});function T(){const g={method:"put",body:JSON.stringify(i.value.tasks)};fetch(`${S.value}api/cron/set`,g).then(async b=>{b.ok&&s()}).catch(b=>{})}A(()=>y.value.err,g=>{!g&&r&&s()});function D(g){if(v.value===null){v.value=g;return}if(v.value==g){v.value=null,a.value=void 0;return}a.value=g,setTimeout(()=>{i.value.tasks.splice(g,0,i.value.tasks.splice(v.value,1)[0]),v.value=null,u.value=!0,a.value=void 0},455)}return(g,b)=>{var G,H,X;return n(),c("div",null,[f(h,{onClick:b[0]||(b[0]=j=>g.$router.go(-1)),label:"<<",class:"mx-2"}),f(h,{onClick:b[1]||(b[1]=j=>{u.value=!1,w()}),label:"refresh"}),f(h,{onClick:b[2]||(b[2]=j=>{u.value=!1,o()}),label:"reload"}),e("div",Mt,[e("div",{class:k(["col-4 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])}," UpTime: "+p(~~($(y).uptime/60))+"min ",3),e("div",{class:k(["col-4 col-sm-12 pa-2 justify-cc",{"bg-warn":$(y).err}])}," PLC time: "+p(m.value),3)]),b[6]||(b[6]=e("h3",null,"Cron tab",-1)),e("div",Nt,[e("div",Bt,p((G=i.value)==null?void 0:G.name),1),e("div",Lt,[e("div",zt,[e("div",Dt,[b[3]||(b[3]=e("div",{class:"col-12 px-2"}," Cron table: ",-1)),e("div",qt,[(n(!0),c(O,null,N((H=i.value)==null?void 0:H.tasks,(j,E)=>(n(),c("div",{class:k(["_mx-2 d-flex_ tab_wrap",{up:v.value===E&&v.value>a.value,down:v.value===E&&v.value<a.value}])},[f(h,{onClick:J=>D(E),label:v.value===E?"<>":E+".",title:"position",class:k({ch_index:v.value===E})},null,8,["onClick","label","class"]),f(h,{class:k([j[0]?"_bg-positive":"bg-secondary"]),onClick:J=>{j[0]=!j[0],u.value=!0},label:j[0]?"o":"~",_label:"o"},null,8,["class","onClick","label"]),f(h,{onClick:J=>t(j),label:j[1]},null,8,["onClick","label"]),e("span",Et,p(j[2]),1),f(h,{onClick:J=>l(j),label:j[3]},null,8,["onClick","label"]),f(h,{onClick:J=>d(j),label:j[4]},null,8,["onClick","label"]),f(h,{onClick:J=>{i.value.tasks.splice(E,1),u.value=!0},label:"-"},null,8,["onClick"])],2))),256))])]),e("div",Ut,[e("div",Jt,[b[4]||(b[4]=I(" Command's: ")),e("span",At,[u.value?(n(),L(h,{key:0,class:"bg-warn",onClick:T,label:"Save"})):P("",!0)])]),(n(!0),c(O,null,N((X=i.value)==null?void 0:X.cmd_list,(j,E)=>(n(),c("div",Rt,[I(p(j)+" ",1),f(h,{onClick:J=>{_(j),u.value=!0},label:"+"},null,8,["onClick"])]))),256))])]),b[5]||(b[5]=e("pre",{class:"txt-left pa-md-2_ pa-2",style:{"white-space":"break-spaces"}},`Schedule string: "* * * * *" as position "mm hh dw dd my" where:
mm - minutes,
hh - hours,
dw - day of week (1-mo, 2-tu, ..., 7-su),
dd - day of month,
my - month of year,
format: every position * may be as any number;
 integer number;
 range of number 2-9;
 list 1,2,3;
 number with delimiter (example: */3 for step every third), range with step throw delimiter 4-20/4 every fourth
      `,-1))])])])}}}),Kt=z(Ft,[["__scopeId","data-v-7d7648e9"]]),ul=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"})),Zt={class:"row pa-2"},Vt={class:"row pa-2"},Gt=M({__name:"settings",setup(C){const i=x(null);let r=null;function u(){fetch(`${S}api/status`).then(async s=>{if(s.ok){const o=await s.json();i.value=o}else i.value=[]}).catch(s=>i.value=[])}const v=U(()=>{var s;return((s=y.value)==null?void 0:s.datetime)&&new Date(y.value.datetime).toISOString().slice(8,16).replace("T"," ")});function a(){u()}return q(()=>{r=!0,u()}),R(()=>{r=!1}),A(()=>y.value.err,s=>{!s&&r&&u()}),(s,o)=>(n(),c("div",null,[f(h,{onClick:o[0]||(o[0]=m=>s.$router.go(-1)),label:"<<",class:"mx-2"}),f(h,{onClick:a,label:"refresh"}),o[2]||(o[2]=e("h3",null,"Settings - settings",-1)),e("div",Zt,[e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])}," PLC time: "+p(v.value),3),e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])},"Free mem: "+p(~~($(y).mem_free/100)/10)+"k",3),e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])},"UpTime: "+p(~~($(y).uptime/60))+"min",3),e("div",{class:k(["col-3 col-sm-6 pa-2 justify-cc",{"bg-warn":$(y).err}])},"CPU load: "+p(~~($(y).load*100+1))+"%",3)]),(n(!0),c(O,null,N(i.value,(m,_)=>(n(),c("div",Vt,o[1]||(o[1]=[e("div",{class:"col-md-12 _col-4 px-2 _text-b"}," Page in dev mode ",-1)])))),256))]))}}),cl=Object.freeze(Object.defineProperty({__proto__:null,default:Gt},Symbol.toStringTag,{value:"Module"})),Ht={class:"row px-2"},Xt={class:"col-6 col-md-12 px-2 _text-b align-ic justify-cc"},Qt=M({__name:"servers_api",setup(C){const i=Z();x(null);const r=x(S),u=x([{name:"main-this '/'",host:"/",state:""},{name:"PLC- reserv .1.108",host:"http://192.168.1.108/",state:""},{name:"PLC-holl-2 .5.120",host:"http://192.168.5.120/",state:""},{name:"PLC-pole-3 .5.111",host:"http://192.168.5.111/",state:""},{name:"PLC-wirpool-4 .1.108",host:"http://192.168.1.108/",state:""}]);let v=null;function a(){i.name=="servers_api"&&(u.value.forEach((o,m)=>{setTimeout(()=>{fetch(`${o.host}ping`).then(async _=>{_.ok&&(await _.text()).search("pong")===0?o.state=!0:o.state=!1}).catch(_=>o.state=!1)},m*300)}),v=setTimeout(a,737*1e3))}q(()=>{clearTimeout(v),a()});function s(o){S.value=o.host,localStorage.setItem("current_host",S.value)}return(o,m)=>(n(),c("div",null,[f(h,{onClick:m[0]||(m[0]=_=>o.$router.go(-1)),label:"<<",class:"mx-2"}),m[1]||(m[1]=e("h3",null,"Servers REST API",-1)),e("h5",null,"current host: "+p(r.value),1),e("div",Ht,[(n(!0),c(O,null,N(u.value,_=>(n(),c("div",Xt,[f(h,{onClick:t=>s(_),ladge:"",label:(_==null?void 0:_.name)||"switch"},{prepend:B(()=>[e("div",{class:k(["lamp",{on:_.state,off:_.state===!1}]),_label:"switch"},null,2)]),_:2},1032,["onClick","label"])]))),256))])]))}}),rl=Object.freeze(Object.defineProperty({__proto__:null,default:Qt},Symbol.toStringTag,{value:"Module"}));export{el as L,z as _,y as a,S as b,ol as c,il as d,ul as e,sl as f,cl as g,tl as h,ll as i,rl as j,al as n,nl as s};
